<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.or.nextit.free.dao.IFreeBoardDao">


	<sql id="freeSearch">
		<if test="searchWord != null and searchWord !=''">
			<choose>
				<when test='searchType=="T"'>
					and bo_title like '%' || #{searchWord} || '%'
				</when>
				<when test='searchType=="W"'>
					and bo_writer like '%' || #{searchWord} || '%'
				</when>
				<when test='searchType=="C"'>
					and bo_content like '%' || #{searchWord} || '%'
				</when>
			</choose>
		</if>

		<if test="searchCategory != null and searchCategory !=''">
			and bo_category = #{searchCategory}
		</if>
	</sql>



	<insert id="insertBoard"
		parameterType="kr.or.nextit.free.vo.FreeBoardVO">
		insert into member(
		INSERT INTO free_board (
		bo_no ,
		bo_title , bo_category
		, bo_writer , bo_pass , bo_content
		, bo_ip ,
		bo_hit , bo_reg_date
		, bo_del_yn
		) VALUES (
		? , ? , ?
		, ? , ? , ?
		, ? , 0 ,
		sysdate
		, 'N'
		)
	</insert>

	<insert id="getFreeBoardkey"
		parameterType="kr.or.nextit.free.vo.FreeBoardVO">
		SELECT
		'B01-'||TO_CHAR(SYSDATE,'YYYY')||'-'||LPAD((select count(bo_no)+1 from
		free_board),6,'0')AS bo_no FROM DUAL
	</insert>


	<select id="getBoardList"
	parameterType="kr.or.nextit.free.vo.FreeBoardSearchVO"
		resultType="kr.or.nextit.free.vo.FreeBoardVO">
		select
		d.*
		from (
		select
		rownum as rnum
		,c.*
		from(
		select
		bo_no
		,bo_title
		,bo_category
		,bo_writer
		,bo_content
		,bo_ip
		,bo_hit
		,to_char(bo_reg_date, 'YYYY-MM-DD') as bo_reg_date
		,to_char(bo_mod_date, 'YYYY-MM-DD') as bo_mod_date
		,bo_del_yn
		,bo_del_id
		,bo_del_date
		, b.comm_nm as bo_category_nm
		FROM free_board a,
		comm_code b
		where a.bo_category = b.comm_cd
		and a.bo_del_yn = 'N'

		<include refid="freeSearch"></include>

		order by bo_no
		)c
		order by rnum desc )d
		<!-- where rnum between ? and ? -->

		<include refid="common.sql.rnum"></include>
	</select>

	<select id="getTotalRowCount"
		parameterType="kr.or.nextit.free.vo.FreeBoardSearchVO"
		resultType="int">
		select count(*)
		from free_board
		where bo_del_yn ='N'

		<include refid="freeSearch"></include>
	</select>

	<select id="getBoard" parameterType="string"
		resultType="kr.or.nextit.free.vo.FreeBoardVO">

		select
		bo_no
		,bo_title
		,bo_category
		,bo_writer
		,bo_pass
		,bo_content
		,bo_ip
		,bo_hit
		,to_char(bo_reg_date,
		'YYYY-MM-DD') as
		bo_reg_date
		,to_char(bo_mod_date, 'YYYY-MM-DD') as
		bo_mod_date
		,bo_del_yn
		,bo_del_id
		,bo_del_date
		,b.comm_nm as
		bo_category_nm
		from
		free_board a,
		comm_code b
		where a.bo_category =
		b.comm_cd
		and a.bo_no= ?
	</select>

	<update id="increaseHit" parameterType="string">
		update free_board set
		bo_hit = bo_hit+1
		where bo_no = ?
	</update>

	<update id="updateBoard"
		parameterType="kr.or.nextit.free.vo.FreeBoardVO">
		UPDATE free_board SET
		bo_title = ?
		, bo_category = ?
		,
		bo_content = ?
		, bo_ip = ?
		, bo_mod_date = sysdate
		WHERE bo_no = ?
	</update>

	<update id="deleteBoard"
		parameterType="kr.or.nextit.free.vo.FreeBoardVO">
		UPDATE free_board SET
		bo_del_yn = 'Y'
		,bo_del_id = ?
		,bo_del_date = sysdate
		WHERE bo_no = ?
	</update>

	<select id="checkAdmin"
		parameterType="kr.or.nextit.free.vo.FreeBoardVO">
		SELECT
		COUNT(*)
		FROM MEMBER_ROLE
		WHERE USER_ID =?
		and USER_ROLE='AD'
	</select>
	
	

</mapper>